@model List<NieGumex.ViewModels.ProductsVm>

@using NieGumex.Infrastructure
@{
    ViewBag.Title = "Index";
}
<script src="~/Scripts/jquery-2.2.3.intellisense.js"></script>
<script src="~/Scripts/jquery-ui-1.8.14.min.js"></script>
<script src="~/Scripts/jquery-ui-1.8.14.js"></script>
<script src="~/Scripts/jquery-2.2.3.min.js"></script>
<script src="~/Scripts/jquery-2.2.3.js"></script>
<h2>Lista produktów</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>

<form id="search-form">
    <input id="search-filter" type="search" name="searchQuery" data-autocomplete-source="@Url.Action("OponySuggestions")"
           placeholder="Wprowadź tekst, aby wyfiltrować..." />
    <input type="submit" value="" />
</form>

@using (Html.BeginForm("Index", "Product"))
{
    <table class="table">
        <tr>
            <th>
                @Html.DisplayName("Foto")
            </th>
            <th>
                @Html.DisplayName("Nazwa")
            </th>
            <th>
                @Html.DisplayName("Cena")
            </th>
            <th>
                @Html.DisplayName("Liczba Dostepnych Kompletów")
            </th>
            <th>
                Wybierz ilość kompletow
            </th>
            <th></th>
        </tr>

        @for (var i = 0; i < Model.Count(); i++)
        {
            <tr>
                <td>
                    <img src="@Url.OponaFotoPath(Model[i].FotoOpona)" height="150" width="150" />

                </td>
                <td>
                    @Model[i].Nazwa
                    <input type="hidden" name="[@i].ProductID" value="@Model[i].ProductID" />
                    <input type="hidden" name="[@i].Nazwa" value="@Model[i].Nazwa" />
                </td>
                <td>
                    @Model[i].Cena
                    <input type="hidden" name="[@i].Cena" value="@Model[i].Cena" />
                </td>
                <td>
                    @Model[i].LiczbaKompletow
                    <input type="hidden" name="[@i].LiczbaKompletow" value="@Model[i].LiczbaKompletow" />
                </td>
                <td>
                    <input type="text" name="[@i].WantIt" value="@Model[i].WantIt" />
                    <input type="hidden" name="[@i].EAN" value="@Model[i].EAN" />
                </td>

                <td>
                    @Html.ActionLink("Edit", "Edit", new { id = Model[i].ProductID }) |
                    @Html.ActionLink("Details", "Details", new { id = Model[i].ProductID }) |
                    @Html.ActionLink("Delete", "Delete", new { id = Model[i].ProductID })
                </td>
            </tr>
        }




    </table>
    <div>
        <input type="submit" class="btn btn-default" id="submit-products-form" value="Kup" />
    </div>
}

@section scripts {
    @System.Web.Optimization.Scripts.Render("~/bundles/jquery")

    <script>
        $(function () {

            var ajaxSubmit = function () {

                var $form = $(this);

                var settings = {
                    data: $(this).serialize(),
                    url: $(this).attr("action"),
                    type: $(this).attr("method")
                };

                $.ajax(settings).done(function (result) {
                    var $targetElement = $($form.data("ajax-target"));
                    var $newContent = $(result);
                    $($targetElement).replaceWith($newContent);
                    $newContent.effect("slide");
                });

                return false;
            };


            var setupAutoComplete = function () {
                var $input = $(this);

                var options = {
                    source: $input.attr("data-autocomplete-source"),
                    select: function (event, ui) {
                        $input = $(this);
                        $input.val(ui.item.label);
                        var $form = $input.parents("form:first");
                        $form.submit();
                    }
                };

                $input.autocomplete(options);
            };

            $("#search-form").submit(ajaxSubmit);
            $("#search-filter").each(setupAutoComplete);

        });

    </script>

}